<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nenepadi.me | Capturing audio the native way - Android</title>
  <meta name="description" content="The android platform has a very easy way that we could capture audio; either from the gadgets microphone, or a call. Lets see how we will build a custom recording application.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Capturing audio the native way - Android">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/posts/android-audio-capture">
  <meta property="og:description" content="The android platform has a very easy way that we could capture audio; either from the gadgets microphone, or a call. Lets see how we will build a custom recording application.">
  <meta property="og:site_name" content="nenepadi.me">
  <meta property="og:image" content="/assets/og-image.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="/posts/android-audio-capture">
  <meta name="twitter:title" content="Capturing audio the native way - Android">
  <meta name="twitter:description" content="The android platform has a very easy way that we could capture audio; either from the gadgets microphone, or a call. Lets see how we will build a custom recording application.">
  <meta name="twitter:image" content="/assets/og-image.jpg">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/logo/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/logo/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/logo/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/logo/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/logo/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/logo/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/logo/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/logo/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/logo/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/logo/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/logo/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/logo/favicon-16x16.png">
  <link rel="manifest" href="/assets/logo/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/logo/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="nenepadi.me Last 10 blog posts" />

  

  
    <link rel="stylesheet" href="/assets/light.css">

  
</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav appear">
  <a href="/" class="header-logo" title="nenepadi.me">nenepadi.me</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://twitter.com/ademang" rel="noreferrer noopener" target="_blank" title="Twitter">
          <span class="icon icon-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/nenepadi" rel="noreferrer noopener" target="_blank" title="GitHub">
          <span class="icon icon-github"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://www.linkedin.com/in/obed-ademang" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <span class="icon icon-linkedin"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="mailto:obed.ademang@gmail.com" title="Email">
          <span class="icon icon-email"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <span class="icon icon-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article appear">
          <header class="article-header">
            <h1>Capturing audio the native way - Android</h1>
            <p>The android platform has a very easy way that we could capture audio; either from the gadgets microphone, or a call. Lets see how we will build a custom recording application.</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                August 12, 2016
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  9 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/mobile">mobile</a>
                
                  <a href="/tag/tutorials">tutorials</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p>The Android multimedia framework includes support for capturing and encoding a variety of common audio formats, so that you can easily integrate audio into your applications. You can record audio using the <a href="https://developer.android.com/reference/android/media/MediaRecorder.html">MediaRecorder</a> APIs if supported by the device hardware and playback audio using <a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a>. This write-up will introduce you on how to record audio and play it back.</p>

<blockquote>
  <h4 id="note-the-android-emulator-does-not-have-the-ability-to-capture-audio-but-actual-devices-are-likely-to-provide-these-capabilities">Note: The Android Emulator does not have the ability to capture audio, but actual devices are likely to provide these capabilities.</h4>
</blockquote>

<p>You will need the following tools to accomplish the purpose of this write-up:</p>

<ul>
  <li>An android phone (for testing)</li>
  <li>Android studio. <a href="https://developer.android.com/studio/index.html">Download and install for your platform.</a></li>
  <li>Time</li>
  <li>Game-on attitude</li>
</ul>

<h2 id="starting-a-new-application">Starting a new application</h2>

<p>Basically we are starting off with an empty activity template. What this means is that we are given the whole authority to choose which ever way we want our launcher (first activity that shows) to be.</p>

<h2 id="designing-the-view">Designing the view</h2>

<p>Enough of the talks. Lets do some action. We will start off first with the view of the application. We need to put our designing swag on as this will need a little bit of artistic mind to finish it up. Okay, I came up with the following design.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:paddingBottom=</span><span class="s">"1dp"</span>
    <span class="na">android:paddingLeft=</span><span class="s">"2dp"</span>
    <span class="na">android:paddingRight=</span><span class="s">"2dp"</span>
    <span class="na">android:paddingTop=</span><span class="s">"1dp"</span>
    <span class="na">tools:context=</span><span class="s">"me.nenepadi.nene.audiocapture.MainActivity"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;LinearLayout</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_alignParentTop=</span><span class="s">"true"</span>
        <span class="na">android:layout_centerHorizontal=</span><span class="s">"true"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;TextView</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:textAppearance=</span><span class="s">"?android:attr/textAppearanceLarge"</span>
            <span class="na">android:text=</span><span class="s">""</span>
            <span class="na">android:id=</span><span class="s">"@+id/textView"</span>
            <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;ImageView</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
            <span class="na">android:id=</span><span class="s">"@+id/imageView"</span>
            <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
            <span class="na">android:src=</span><span class="s">"@drawable/mic"</span>
            <span class="na">android:layout_weight=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;RelativeLayout</span>
            <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;Button</span>
                <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:text=</span><span class="s">"play record"</span>
                <span class="na">android:id=</span><span class="s">"@+id/btnPlayRecord"</span>
                <span class="na">android:layout_alignParentLeft=</span><span class="s">"true"</span>
                <span class="na">android:layout_alignParentStart=</span><span class="s">"true"</span>
                <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                <span class="na">android:onClick=</span><span class="s">"audioCaptureAndPlayback"</span>
                <span class="na">android:enabled=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>

            <span class="nt">&lt;Button</span>
                <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:text=</span><span class="s">"refresh rec"</span>
                <span class="na">android:id=</span><span class="s">"@+id/btnRefreshActivity"</span>
                <span class="na">android:layout_centerInParent=</span><span class="s">"true"</span>
                <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                <span class="na">android:visibility=</span><span class="s">"invisible"</span>
                <span class="na">android:onClick=</span><span class="s">"audioCaptureAndPlayback"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;Button</span>
                <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:text=</span><span class="s">"start record"</span>
                <span class="na">android:layout_centerInParent=</span><span class="s">"true"</span>
                <span class="na">android:id=</span><span class="s">"@+id/btnStartRecord"</span>
                <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                <span class="na">android:onClick=</span><span class="s">"audioCaptureAndPlayback"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;Button</span>
                <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:text=</span><span class="s">"stop record"</span>
                <span class="na">android:layout_alignParentRight=</span><span class="s">"true"</span>
                <span class="na">android:layout_alignParentEnd=</span><span class="s">"true"</span>
                <span class="na">android:id=</span><span class="s">"@+id/btnStopRecord"</span>
                <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                <span class="na">android:onClick=</span><span class="s">"audioCaptureAndPlayback"</span>
                <span class="na">android:enabled=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>

            <span class="nt">&lt;Button</span>
                <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:text=</span><span class="s">"stop playbk"</span>
                <span class="na">android:layout_alignParentRight=</span><span class="s">"true"</span>
                <span class="na">android:layout_alignParentEnd=</span><span class="s">"true"</span>
                <span class="na">android:id=</span><span class="s">"@+id/btnStopPlayback"</span>
                <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                <span class="na">android:visibility=</span><span class="s">"invisible"</span>
                <span class="na">android:onClick=</span><span class="s">"audioCaptureAndPlayback"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/RelativeLayout&gt;</span>

    <span class="nt">&lt;/LinearLayout&gt;</span>
<span class="nt">&lt;/RelativeLayout&gt;</span></code></pre></figure>

<h2 id="making-the-app-work">Making the app work</h2>

<p>Now lets outline the steps that the app will go through to call it a working application.</p>

<ol>
  <li>Launch the app.</li>
  <li>Click the <strong>START RECORD</strong> button and record your sound.</li>
  <li>Eventually click the <strong>STOP RECORD</strong> button to stop recording.</li>
  <li>Click the <strong>PLAY RECORD</strong> button to play the sound you recorded.</li>
  <li>Eventually click the <strong>STOP PLAYBK</strong> to stop the playback.</li>
  <li>Click the <strong>REFRESH REC</strong> to start the process over again.</li>
</ol>

<p>Simple right? Lets take this little by little. First lets see how our <em>MainActivity.java</em> file should look like before we start editing it.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">me</span><span class="o">.</span><span class="na">nenepadi</span><span class="o">.</span><span class="na">nene</span><span class="o">.</span><span class="na">audiocapture</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">audioCaptureAndPlayback</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Now lets create an instance of all the elements on the view and every other variables we might need.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">.....</span>
<span class="o">.....</span>
<span class="o">.....</span>

<span class="kn">import</span> <span class="nn">android.annotation.SuppressLint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.media.MediaPlayer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.media.MediaRecorder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Environment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="n">Button</span> <span class="n">btnPlayRecord</span><span class="o">,</span> <span class="n">btnRefreshActivity</span><span class="o">,</span> <span class="n">btnStartRecord</span><span class="o">,</span>
            <span class="n">btnStopRecord</span><span class="o">,</span> <span class="n">btnStopPlayback</span><span class="o">;</span>
    <span class="n">TextView</span> <span class="n">tvStatus</span><span class="o">;</span>
    <span class="n">ImageView</span> <span class="n">ivPicture</span><span class="o">;</span>
    <span class="n">Intent</span> <span class="n">intent</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">MediaRecorder</span> <span class="n">mediaRecorder</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">MediaPlayer</span> <span class="n">mediaPlayer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">OUT_FILE</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="c1">// set the output file insite the external storage area</span>
        <span class="n">OUT_FILE</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()</span> <span class="o">+</span>
                <span class="s">"/audioCaptureSound.3gpp"</span><span class="o">;</span>

        <span class="c1">// use the id reference of all the elements to create java-like gui objects</span>
        <span class="n">btnPlayRecord</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnPlayRecord</span><span class="o">);</span>
        <span class="n">btnRefreshActivity</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnRefreshActivity</span><span class="o">);</span>
        <span class="n">btnStartRecord</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnStartRecord</span><span class="o">);</span>
        <span class="n">btnStopRecord</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnStopRecord</span><span class="o">);</span>
        <span class="n">btnStopPlayback</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnStopPlayback</span><span class="o">);</span>

        <span class="n">tvStatus</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView</span><span class="o">);</span>
        <span class="n">ivPicture</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">.....</span>
    <span class="o">.....</span>
    <span class="o">.....</span>
<span class="o">}</span></code></pre></figure>

<p>Now lets go on and write some code for the one function/method that controls all our major actions or events.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">.....</span>
<span class="o">.....</span>
<span class="o">.....</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="o">.....</span>
    <span class="o">.....</span>
    <span class="o">.....</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">audioCaptureAndPlayback</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">getId</span><span class="o">()){</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnStartRecord</span><span class="o">:</span>
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">startRecord</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnStopRecord</span><span class="o">:</span>
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">stopRecord</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnPlayRecord</span><span class="o">:</span>
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">playRecord</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnStopPlayback</span><span class="o">:</span>
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">stopPlayback</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnRefreshActivity</span><span class="o">:</span>
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">refreshActivity</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="o">.....</span>
    <span class="o">.....</span>
    <span class="o">.....</span>
<span class="o">}</span></code></pre></figure>

<p>To record a sound you have to do the following:</p>

<ol>
  <li>set the source of the recording to the phone’s microphone</li>
  <li>make output format .3gpp</li>
  <li>encode the recorded file</li>
  <li>set the output file</li>
  <li>prepare and start recording</li>
</ol>

<p>This is how the <em>startRecord()</em> function should look like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">"SetTextI18n"</span><span class="o">)</span>  <span class="c1">// used to suppress internationalisation of texts ...</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">startRecord</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="c1">// release mediaRecorder if the is one trending already ...</span>
    <span class="k">if</span><span class="o">(</span><span class="n">mediaRecorder</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
        <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>

    <span class="c1">// create a file to test whether one exists already. Delete if it exists ...</span>
    <span class="n">File</span> <span class="n">output_file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">OUT_FILE</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">output_file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span>
        <span class="n">output_file</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>

    <span class="c1">// disable btnStartRecord and enable btnStopRecord</span>
    <span class="n">btnStartRecord</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>
    <span class="n">btnRefreshActivity</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
    <span class="n">btnStopRecord</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">btnPlayRecord</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

    <span class="cm">/*
     * 1. set the source of the recording to the phone's microphone
     * 2. make output format .3gpp
     * 3. encode the recorded file
     * 4. set the output file
     * 5. prepare and start recording
     */</span>
    <span class="n">mediaRecorder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MediaRecorder</span><span class="o">();</span>
    <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setAudioSource</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">AudioSource</span><span class="o">.</span><span class="na">MIC</span><span class="o">);</span>
    <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setOutputFormat</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">OutputFormat</span><span class="o">.</span><span class="na">THREE_GPP</span><span class="o">);</span>
    <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setAudioEncoder</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">AudioEncoder</span><span class="o">.</span><span class="na">AMR_NB</span><span class="o">);</span>
    <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setOutputFile</span><span class="o">(</span><span class="n">OUT_FILE</span><span class="o">);</span>
    <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
    <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

    <span class="n">tvStatus</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Audio is been recorded ..."</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>This is how the <em>stopRecord()</em> function should look like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">"SetTextI18n"</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">stopRecord</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// stop mediaRecorder</span>
    <span class="k">if</span><span class="o">(</span><span class="n">mediaRecorder</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
        <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>

    <span class="c1">// make visible the playback buttons ...</span>
    <span class="n">btnPlayRecord</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">btnStopRecord</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

    <span class="n">tvStatus</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Audio saved successfully ..."</span><span class="o">);</span>

    <span class="c1">// change the inageviews source using a resource id ...</span>
    <span class="n">ivPicture</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">headphones</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>This is how the <em>playRecord()</em> should look like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">"SetTextI18n"</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">playRecord</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="c1">// ditch mediaPlayer if it is already active ...</span>
    <span class="k">if</span><span class="o">(</span><span class="n">mediaPlayer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
        <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>

    <span class="n">btnPlayRecord</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">btnStopRecord</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>
    <span class="n">btnStopPlayback</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
    <span class="n">btnStopPlayback</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

    <span class="c1">// set media source, prepare and play it ...</span>
    <span class="n">mediaPlayer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MediaPlayer</span><span class="o">();</span>
    <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">OUT_FILE</span><span class="o">);</span>
    <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
    <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="n">tvStatus</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Playing recorded sound ..."</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>This is how the <em>stopPlayback()</em> should look like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">"SetTextI18n"</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">stopPlayback</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">mediaPlayer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">btnPlayRecord</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">btnStopPlayback</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

    <span class="n">tvStatus</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Playback stopped successfully ..."</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>This is how the <em>refreshActivity()</em> should look like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">refreshActivity</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">overridePendingTransition</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NO_ANIMATION</span><span class="o">);</span>
        <span class="n">finish</span><span class="o">();</span>
        <span class="n">overridePendingTransition</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span></code></pre></figure>

<p>Now finally, to make the application not hang when recording sound we need to seek permission from the device to use it’s microphone and also gain access to write a file to the external storage. All these should be done in the <em>AndroidManifest.xml</em> file. This is how this file should look like:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"me.nenepadi.nene.audiocapture"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.RECORD_AUDIO"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:supportsRtl=</span><span class="s">"true"</span>
        <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span>
        <span class="na">android:screenOrientation=</span><span class="s">"portrait"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".MainActivity"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span></code></pre></figure>

<p class="notice">Note that all extra drawables were downloaded. The <a href="http://iconizer.net/files/Brilliant/orig/headphones.png">headphones drawable</a> and the <a href="http://images.clipartpanda.com/microphone-black-and-white-audio_input_microphone_coloring_book-999px.png">microphone drawable</a>.</p>

<p>After you are sure you understand the processes taken to record a media file and play it back, test the application on a physical device - not an emulator, and <strong>leave your issues and feedback in the comments box</strong>. Whoops this is lengthy, but it is worthwhile.</p>

<p>Ardios.</p>

          </div>

          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Capturing+audio+the+native+way+-+Android - /posts/android-audio-capture by @ademang" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=/posts/android-audio-capture" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
            <a href="https://plus.google.com/share?url=/posts/android-audio-capture" title="Share on Google+" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 128 128"><path d="M40.7 55.9v16.1c0 0 15.6 0 22 0C59.2 82.5 53.8 88.2 40.7 88.2c-13.3 0-23.7-10.8-23.7-24.2s10.4-24.2 23.7-24.2c7.1 0 11.6 2.5 15.8 5.9 3.3-3.3 3.1-3.8 11.6-11.9 -7.2-6.6-16.8-10.6-27.4-10.6C18.2 23.3 0 41.5 0 64c0 22.5 18.2 40.7 40.7 40.7 33.6 0 41.8-29.3 39-48.8H40.7zM113.9 56.7V42.6h-10.1v14.1H89.4v10.1h14.5v14.5h10.1V66.8H128V56.7H113.9z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://nenepadi.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer appear">
  <p style="text-align: center;">
    Owned by <a href="/about" title="About me">Nenepadi Ademang</a>.
    Powered by <a href="https://pages.github.com/" rel="noreferrer noopener" target="_blank">Github Pages</a>
    with <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Download Chalk">Chalk</a> theme.
    <br>
    &copy;<script>document.write(new Date().getFullYear());</script> Nenepadi.me
  </p>
</footer>

      </div>
    </div>
  </main>
  

<script src="/assets/vendor.js"></script>



  <script src="/assets/webfonts.js"></script>




  <script src="/assets/scrollappear.js"></script>



<script src="/assets/application.js"></script>


</body>
</html>
